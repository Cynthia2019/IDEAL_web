import * as d3 from "d3";
const MARGIN = {
  TOP: 100,
  RIGHT: 50,
  BOTTOM: 100,
  LEFT: 100,
};
const SIDE = 300; 
const WIDTH = SIDE - MARGIN.LEFT - MARGIN.RIGHT;
const HEIGHT = SIDE - MARGIN.TOP - MARGIN.BOTTOM;

class Structure {
  constructor(element, data) {
    this.svg = d3
      .select(element)
      .append("svg")
      .attr("width", WIDTH + MARGIN.LEFT + MARGIN.RIGHT)
      .attr("height", HEIGHT + MARGIN.TOP + MARGIN.BOTTOM)
      .append("g")
      .attr("transform", `translate(${MARGIN.LEFT}, ${MARGIN.RIGHT})`);
    this.update(data);
  }
  update(data) {
    this.data = data.map((d) => d.geometry);
    let res = []
  //  res = this.data.map(d => this.pixelate(d));
    res = this.pixelate("0000000000000000000011111111110000000000000000000000000000000000000000111111111100000000000000000000000000000000000000001111111111000000000000000000000000000000000000000011111111110000000000000000000000000000000000000000111111111100000000000000000000000000000000000111111111111111111110000000000000000000000000000001111111111111111111100000000000000000000000000000011111111111111111111000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101111111111111111111111111111111111111111111111110001111111111111111111111111111111111111111111111000011111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111100001111111111111111111111111111111111111111111111000011111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111100001111111111111111111000000001111111111111111111000011111111111111111110000000011111111111111111110000111111111111111111100000000111111111111111111100001111111111111100000000000000000011111111111111000011111111111111000000000000000000111111111111110000111111111111110000000000000000001111111111111100001111111111111100000000000000000011111111111111000011111111111111000000000000000000111111111111110000111111111111110000000000000000001111111111111100001111111111111100000000000000000011111111111111000011111111111111000000000000000000111111111111110000111111111111110000000000000000001111111111111100001111111111111100000000000000000011111111111111000011111111111111111110000000011111111111111111110000111111111111111111100000000111111111111111111100001111111111111111111000000001111111111111111111000011111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111100001111111111111111111111111111111111111111111111000011111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111100001111111111111111111111111111111111111111111111000111111111111111111111111111111111111111111111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000001111111111111111111100000000000000000000000000000011111111111111111111000000000000000000000000000000111111111111111111110000000000000000000000000000000000011111111110000000000000000000000000000000000000000111111111100000000000000000000000000000000000000001111111111000000000000000000000000000000000000000011111111110000000000000000000000000000000000000000111111111100000000000000000000");
    const yScale = d3.scaleLinear().domain([0, 50]).range([HEIGHT, 0]);

    const xScale = d3.scaleLinear().domain([0, 50]).range([0, WIDTH]);

    const size = SIDE / 50; 

    const pixels = this.svg.selectAll("rect").data(res);
    pixels
      .enter()
      .append("rect")
      .attr("x", (d) => xScale(d.x))
      .attr("y", (d) => yScale(d.y))
      .attr("width", size)
      .attr("height", size)
      .attr("fill", (d) => d.fill);

    pixels.exit().remove();
  }
  pixelate(data) {
    if(!data) return [];
    const xSquares = 50;
    const ySquares = 50;
    let d = [];
    for (let i = 0; i < xSquares; i++) {
      for (let j = 0; j < ySquares; j++) {
        d.push({
          x: i,
          y: j,
          fill: data[i * xSquares + j] == "0" ? "white" : "black",
        });
      }
    }
    return d;
  }
}

export default Structure;
